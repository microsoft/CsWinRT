parameters: 
  - name: "BuildConfiguration"
    type: string
    default: "release"
  - name: "BuildPlatform"
    type: string
    default: "x86"

variables:
- template: CsWinRT-Variables.yml@self

name: $(MajorVersion).$(MinorVersion).$(PatchVersion)$(PrereleaseVersion).$(date:yyMMdd)$(rev:.r)

trigger: none

resources:
  repositories:
  - repository: templates
    type: git
    name: OneBranch.Pipelines/GovernedTemplates
    ref: refs/heads/main

extends:
  template: v2/Microsoft.NonOfficial.yml@templates
  parameters:
    platform:
      name: 'windows_undocked'
      product: 'build_tools'

    featureFlags:
      WindowsHostVersion:
        Version: 2022
      autoBaseline: false

    globalSdl:
      tsa:
        enabled: false
      sbom:
        enabled: true
      binskim:
        scanOutputDirectoryOnly: true

    customTags: ES365AIMigrationTooling

    stages:
      - stage: buildandtest
        jobs: 
        - template: build/AzurePipelineTemplates/CsWinRT-BuildAndTest-Stage.yml@self
          parameters:
            BuildConfiguration: $(BuildConfiguration)
            BuildVersion: $(BuildVersion)
            
      - stage: Nuget
        dependsOn: buildandtest
        jobs:
        - template: build/AzurePipelineTemplates/CsWinRT-BuildAndTest-Stage.yml@self
          parameters:
            BuildConfiguration: $(BuildConfiguration)
            BuildVersion: $(BuildVersion) 