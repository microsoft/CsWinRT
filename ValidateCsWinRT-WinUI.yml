# This pipeline does a validation test of CsWinRT against XAML scenarios hosted by WinUI

variables:
   # set '_privateIXPNupkgVersion' to 'privateIXPNupkgVersion' if it has been set on the Pipeline, or else default to empty string.
  _DotNetSdkVersion: $[coalesce(variables.DotNetSdkVersion, '')]
  cswinrtFeed: "https://pkgs.dev.azure.com/microsoft/_packaging/CsWinRT/nuget/v3/index.json"
  dotnetFeed: "https://dotnetcli.blob.core.windows.net/dotnet"
steps:

- task: NuGetToolInstaller@1
  displayName: 'Use NuGet 5.3'
  inputs:
    versionSpec: 5.3
  continueOnError: true
- task: NuGetAuthenticate@0

- powershell: |
   #$accessTokenInfo = (az account get-access-token) | Out-String | ConvertFrom-Json
   #if ($lastexitcode -ne 0)
   #{
   #  $loginInfo = az login
   #}
   #az extension add --name azure-devops
    az login
    $ciPipeline = 38157
    $runInfo = 
       (az pipelines run `
       --organization https://dev.azure.com/microsoft `
       --project WinUI `
       --id $ciPipeline `
       --branch "master" `
       --variables "privateCsWinRTNupkgVersion=0.1.0-prerelease.200917.1" "privateDotNetSdkVersion=$(_DotNetSdkVersion)") | ConvertFrom-Json
    $buildUrl = $runInfo.url.Replace("_apis/build/Builds/","_build/results?buildId=")
    
    Write-Host
    Write-Host "Build URL: $buildUrl"
    Start-Process $buildUrl
  displayName: 'Running WinUI CI Pipeline with latest CsWinRT'
